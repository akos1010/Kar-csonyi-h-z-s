<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Név Randomizáló</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('https://cdn.pixabay.com/photo/2021/11/19/15/21/christmas-6809681_1280.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            text-align: center;
        }
        h1 {
            margin-top: 20%;
        }
        #nameForm, #acceptButton {
            display: none;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        button:disabled {
            background-color: gray;
            cursor: not-allowed;
        }
        #result {
            font-size: 24px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>Név Randomizáló</h1>

    <div id="nameForm">
        <label for="username">Add meg a neved:</label>
        <select id="username">
            <!-- A nevek itt lesznek dinamikusan betöltve -->
        </select>
        <button onclick="submitName()">Elküld</button>
    </div>

    <div id="result"></div>
    <button id="pickNameButton" onclick="pickRandomName()">Név kiválasztása</button>
    <button id="acceptButton" onclick="acceptName()">Elfogadom a nevet</button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.5.0/firebase-database.js"></script>
    <script>
        // Firebase konfiguráció
        const firebaseConfig = {
            apiKey: "AIzaSyAuHCMWsyPVpOmQy9UlrSraMGFl0nEslco",
            authDomain: "karihuzas-d848c.firebaseapp.com",
            databaseURL: "https://karihuzas-d848c-default-rtdb.firebaseio.com",
            projectId: "karihuzas-d848c",
            storageBucket: "karihuzas-d848c.firebasestorage.app",
            messagingSenderId: "131356054270",
            appId: "1:131356054270:web:2996f46f0d6e0db9b1cbaf",
            measurementId: "G-GB3BFBH2ZN"
        };

        // Inicializálás
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database(app);

        let username = '';
        let pickedName = '';

        // Oldal betöltésekor meghívott funkció
        window.onload = function() {
            loadNames(); // Nevek betöltése
            document.getElementById('nameForm').style.display = 'block';
        };

        // Nevek betöltése a Firebase-ből a legördülő menübe
        function loadNames() {
            const namesRef = database.ref('names');
            namesRef.once('value').then(function(snapshot) {
                const names = snapshot.val() || [];
                const dropdown = document.getElementById('username');
                names.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    dropdown.appendChild(option);
                });
            });
        }

        // Név kiválasztása
        function submitName() {
            username = document.getElementById('username').value;
            if (username.trim() !== '') {
                document.getElementById('nameForm').style.display = 'none';
                document.getElementById('pickNameButton').style.display = 'block';
            } else {
                alert('Kérlek add meg a neved!');
            }
        }

        // Véletlenszerű név kiválasztása
        function pickRandomName() {
            const namesRef = database.ref('names');
            namesRef.once('value').then(function(snapshot) {
                const names = snapshot.val() || [];
                if (names.length > 0) {
                    // A felhasználó nevét eltávolítjuk a listából
                    const filteredNames = names.filter(name => name !== username);
                    if (filteredNames.length > 0) {
                        const randomIndex = Math.floor(Math.random() * filteredNames.length);
                        pickedName = filteredNames[randomIndex];
                        document.getElementById('result').innerText = `A kiválasztott név: ${pickedName}`;
                        document.getElementById('pickNameButton').style.display = 'none';
                        document.getElementById('acceptButton').style.display = 'block';

                        // A kiválasztott név eltávolítása a Firebase-ből
                        names.splice(names.indexOf(pickedName), 1);
                        namesRef.set(names);
                    } else {
                        alert('Nincs több név!');
                    }
                }
            });
        }

        // Név elfogadása
        function acceptName() {
            const userAcceptedNameRef = database.ref('acceptedNames');
            userAcceptedNameRef.push({ username: username, name: pickedName });

            // Név kiválasztása után az elfogadott név rögzítése
            document.getElementById('result').innerText = `A kiválasztott nevet elfogadtad: ${pickedName}`;
            document.getElementById('acceptButton').disabled = true;
            alert(`Neved: ${username}, a választott név: ${pickedName}`);
        }
    </script>
</body>
</html>
